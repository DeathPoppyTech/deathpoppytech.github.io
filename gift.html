<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gift User</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div id="content" class="container">Loading...</div>
<script>
async function main() {
  const corsProxy = "https://api.allorigins.win/raw?url=";
  const params = new URLSearchParams(window.location.search);
  const username = params.get("user");
  const content = document.getElementById("content");
  if (!username) {
    content.innerHTML = "<p>‚ùå No username provided. <a href='index.html'>Go back</a></p>";
    return;
  }
  content.innerHTML = `<p>üîç Searching for <b>${username}</b>...</p>`;
  try {
    const userRes = await fetch(corsProxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"), {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ usernames: [username] })
    });
    const userData = await userRes.json();
    const user = userData.data?.[0];
    if (!user) {
      content.innerHTML = "<p>‚ùå User not found. <a href='index.html'>Try again</a></p>";
      return;
    }
    const userId = user.id;
    const displayName = user.displayName || user.name;
    const avatar = `https://www.roblox.com/headshot-thumbnail/image?userId=${userId}&width=180&height=180&format=png`;
    const clothingRes = await fetch(corsProxy + encodeURIComponent(`https://catalog.roblox.com/v2/search/items/details?Category=Clothing&CreatorTargetId=${userId}&Limit=30`));
    const clothing = await clothingRes.json();
    const gamesRes = await fetch(corsProxy + encodeURIComponent(`https://games.roblox.com/v2/users/${userId}/games?SortOrder=Asc&Limit=5`));
    const games = await gamesRes.json();
    let passes = [];
    for (const game of games.data || []) {
      const passesRes = await fetch(corsProxy + encodeURIComponent(`https://games.roblox.com/v2/games/${game.id}/game-passes?Limit=25`));
      const passData = await passesRes.json();
      if (passData.data?.length) passes.push(...passData.data);
    }
    let html = `
      <div class="profile">
        <img src="${avatar}" width="120" height="120">
        <h1>${displayName} (@${user.name})</h1>
        <p>User ID: ${userId}</p>
        <a href="index.html" class="back">‚Üê Search another user</a>
      </div>
      <h2>üéüÔ∏è Gamepasses</h2>
      <div class="items">
    `;
    if (passes.length) {
      for (const p of passes) {
        html += `
          <div class="item">
            <img src="https://www.roblox.com/asset-thumbnail/image?assetId=${p.id}&width=150&height=150&format=png">
            <p>${p.name}</p>
            <a href="https://www.roblox.com/game-pass/${p.id}" target="_blank"><button>Buy</button></a>
          </div>
        `;
      }
    } else html += "<p>No gamepasses found.</p>";
    html += "</div><h2>üëï Clothing</h2><div class='items'>";
    if (clothing.data?.length) {
      for (const item of clothing.data) {
        html += `
          <div class="item">
            <img src="https://www.roblox.com/asset-thumbnail/image?assetId=${item.id}&width=150&height=150&format=png">
            <p>${item.name}</p>
            <a href="https://www.roblox.com/catalog/${item.id}" target="_blank"><button>Buy</button></a>
          </div>
        `;
      }
    } else html += "<p>No clothing found.</p>";
    html += "</div>";
    content.innerHTML = html;
  } catch (e) {
    content.innerHTML = `<p>‚ö†Ô∏è Failed to load data. Please try again later.</p>`;
  }
}
main();
</script>
</body>
</html>
