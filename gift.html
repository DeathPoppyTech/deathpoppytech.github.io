<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gift User</title>
<style>
body {
  font-family: system-ui, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 600px;
  margin: 20px auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.profile {
  text-align: center;
}
.profile img {
  border-radius: 50%;
  margin-bottom: 10px;
}
.items {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 12px;
}
.item {
  background: #fafafa;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 8px;
  text-align: center;
}
.item img {
  width: 100%;
  border-radius: 6px;
}
.item .price {
  font-weight: 600;
  color: #555;
}
button {
  background: #00a2ff;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
}
button:hover {
  background: #008be0;
}
.back {
  display: inline-block;
  margin-top: 10px;
  color: #00a2ff;
  text-decoration: none;
}
.back:hover {
  text-decoration: underline;
}
</style>
</head>
<body>
<div id="content" class="container">Loading...</div>
<script>
async function main() {
  const params = new URLSearchParams(location.search);
  const username = params.get("user");
  const content = document.getElementById("content");
  const proxy = "https://corsproxy.io/?";

  if (!username) {
    content.innerHTML = "<p>‚ùå No username provided. <a href='index.html'>Go back</a></p>";
    return;
  }

  content.innerHTML = `<p>üîç Searching for <b>${username}</b>...</p>`;

  try {
    const userRes = await fetch(proxy + encodeURIComponent("https://users.roblox.com/v1/usernames/users"), {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ usernames: [username] })
    });
    const userData = await userRes.json();
    const user = userData.data?.[0];
    if (!user) {
      content.innerHTML = "<p>‚ùå User not found. <a href='index.html'>Try again</a></p>";
      return;
    }

    const userId = user.id;
    const displayName = user.displayName || user.name;
    const avatar = `https://www.roblox.com/headshot-thumbnail/image?userId=${userId}&width=180&height=180&format=png`;

    const clothingRes = await fetch(proxy + encodeURIComponent(`https://catalog.roblox.com/v1/search/items?category=Clothing&creatorTargetId=${userId}&salesTypeFilter=1&limit=10`));
    const clothing = await clothingRes.json();

    const gamesRes = await fetch(proxy + encodeURIComponent(`https://games.roblox.com/v2/users/${userId}/games?limit=5`));
    const gamesData = await gamesRes.json();
    let passesList = [];

    for (const game of gamesData.data || []) {
      const passRes = await fetch(proxy + encodeURIComponent(`https://games.roblox.com/v1/games/${game.id}/game-passes?limit=10`));
      const passData = await passRes.json();
      if (passData.data && passData.data.length) {
        passesList.push(...passData.data.map(p => ({
          name: p.name,
          id: p.id,
          image: `https://www.roblox.com/asset-thumbnail/image?assetId=${p.id}&width=150&height=150&format=png`,
          link: `https://www.roblox.com/game-pass/${p.id}`
        })));
      }
    }

    async function getItemPrice(assetId) {
      try {
        const res = await fetch(proxy + encodeURIComponent(`https://economy.roblox.com/v2/assets/${assetId}/details`));
        const data = await res.json();
        return data.PriceInRobux ?? null;
      } catch {
        return null;
      }
    }

    let html = `
      <div class="profile">
        <img src="${avatar}" width="180" height="180">
        <h1>${displayName} (@${user.name})</h1>
        <p>User ID: ${userId}</p>
        <a href="index.html" class="back">‚Üê Search another user</a>
      </div>
    `;

    html += "<h2>üéüÔ∏è Gamepasses</h2>";
    if (passesList.length > 0) {
      html += `<div class="items">`;
      for (const p of passesList) {
        const price = await getItemPrice(p.id);
        html += `
          <div class="item">
            <img src="${p.image}">
            <p>${p.name}</p>
            <p class="price">${price ? price + " Robux" : "Free"}</p>
            <a href="${p.link}" target="_blank"><button>Buy</button></a>
          </div>
        `;
      }
      html += `</div>`;
    } else html += "<p>No gamepasses found.</p>";

    html += "<h2>üëï Clothing</h2>";
    if (clothing.data && clothing.data.length) {
      html += `<div class="items">`;
      for (const item of clothing.data) {
        const price = await getItemPrice(item.id);
        html += `
          <div class="item">
            <img src="https://www.roblox.com/asset-thumbnail/image?assetId=${item.id}&width=150&height=150&format=png">
            <p>${item.name}</p>
            <p class="price">${price ? price + " Robux" : "Free"}</p>
            <a href="https://www.roblox.com/catalog/${item.id}" target="_blank">
              <button>Buy</button>
            </a>
          </div>
        `;
      }
      html += `</div>`;
    } else html += "<p>No clothing found.</p>";

    content.innerHTML = html;
  } catch {
    content.innerHTML = `<p>‚ö†Ô∏è Failed to fetch data. Roblox API may be blocking requests.</p>`;
  }
}
main();
</script>
</body>
</html>
